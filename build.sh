#!/usr/bin/env bash

##########################################################################
# This is the Cake bootstrapper script for Linux and OS X.
# This file was downloaded from https://github.com/cake-build/resources
# Feel free to change this file to fit your needs.
##########################################################################

# Define directories.
SCRIPT_DIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
TOOLS_DIR=$SCRIPT_DIR/tools

# Define default arguments.
TARGET="Default"
CONFIGURATION="Release"
VERBOSITY="normal"
DRYRUN=
SCRIPT_ARGUMENTS=()

# Parse arguments.
for i in "$@"; do
    case $1 in
        -t|--target) TARGET="$2"; shift ;;
        -c|--configuration) CONFIGURATION="$2"; shift ;;
        -v|--verbosity) VERBOSITY="$2"; shift ;;
        -d|--dryrun) DRYRUN="-dryrun" ;;
        --) shift; SCRIPT_ARGUMENTS+=("$@"); break ;;
        *) SCRIPT_ARGUMENTS+=("$1") ;;
    esac
    shift
done

# Restore Cake tool
if [ -f "$SCRIPT_DIR/.config/dotnet-tools.json" ]; then
    dotnet tool restore
fi

# Start Cake
echo "Running build script..."
dotnet cake --target="$TARGET" --configuration="$CONFIGURATION" --verbosity="$VERBOSITY" $DRYRUN "${SCRIPT_ARGUMENTS[@]}"